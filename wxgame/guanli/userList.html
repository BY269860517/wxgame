<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="keywords" content="Game后台管理" />
<meta name="description" content="Game后台管理" />
<title>Game后台管理</title>
<link href="../css/css.css" rel="stylesheet" type="text/css"/>
<link href="../css/scroll.css" rel="stylesheet" type="text/css"/>
<link href="../css/pop.css" rel="stylesheet" type="text/css"/>
<link href="../css/jquery.webui-popover.min.css" rel="stylesheet" type="text/css"/>
<link href="../css/bootstrap-date.css" rel="stylesheet" type="text/css" />
<link href="../css/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" />
<link href="../layui/css/layui.css" rel="stylesheet" type="text/css" />
<link href="../layui/css/global.css" rel="stylesheet" type="text/css" />
</head>

<body>

<div class="breadcrumb"><a>角色管理</a></div>

<div class="layout_tx layout_margin la_rela" style="height:430px;">
    <div class="kuang_title">角色列表
    	<div class="fr">
            <input type="text" id="demoReload" name="" size="20" placeholder="输入用户名" class="mgr_r" />
            <span class="btn" data-type="reload">查询</span>
            <span class="tk_btn" onClick="showPopBox(0);"><img src="../img/jia_icon.png"/> 新增</span>
        </div>
  </div>
  <script type="text/html" id="barDemo">
    <a class="show-pop" lay-event="edit" data-content="<span>修改</span>"><img src="../img/xiugai.png"/></a>
    <a class="show-pop" lay-event="del" data-content="<span>删除</span>"><img src="../img/shanchu.png"/></a>

    <!-- <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a> -->
  </script>
  <table class="table" id="test"  lay-filter="test"></table> 
</div>

<!--弹框-->
<div class="pop_wp" id="popShow">
    <a href="javascript:;" class="pop_close"></a>
    
     <div class="pop_inner"><!--新增角色-->
        <div class="pop_tit">新增角色</div>
        <table width="100%" border="0" cellspacing="10" class="table_xq">
          <tr>
            <td width="35%" class="tab_te_r"><span class="f_red">*</span>用户名：</td>
            <td><input type="text" id="userName" name="" size="20"/></td>
          </tr>
          <tr>
            <td class="tab_te_r"><span class="f_red">*</span>密码：</td>
            <td><input type="password" id="passWord" name="" size="20"/></td>
          </tr>
          <tr>
              <td class="tab_te_r"><span class="f_red">*</span>手机号码：</td>
              <td><input type="text" id="phone" name="" size="20"/></td>
            </tr>
        </table>

        <div class="btns center">
            <button type="button" class="btn btn_h" onClick="closePopBox()">取消</button>
            <button type="button" class="btn" onClick="addUser()">确定</button>
        </div>
    </div>
    
     <div class="pop_inner"><!--修改角色-->
        <div class="pop_tit">修改角色</div>
        <table width="100%" border="0" cellspacing="10" class="table_xq">
          <tr>
            <td width="35%" class="tab_te_r"><span class="f_red">*</span>用户名：</td>
            <td><input type="text" id="userEditName" name="" size="20"/></td>
          </tr>
          <tr>
            <td class="tab_te_r"><span class="f_red">*</span>密码：</td>
            <td><input type="password" id="userEditPwd" name="" size="20"/></td>
          </tr>
          <tr>
            <td class="tab_te_r"><span class="f_red">*</span>手机号码：</td>
            <td><input type="text" id="userEditPhone" name="" size="20"/></td>
          </tr>
        </table>
        <input type="text" style="display:none" id="Id" />
        <div class="btns center">
            <button type="button" class="btn btn_h" onClick="closePopBox()">取消</button>
            <button type="button" class="btn" onClick="editUser()">确定</button>
        </div>
    </div>
    
    <div class="pop_inner"><!--删除弹框-->
        <div class="pop_tit">删除</div>
        <div class="pop_txt">是否要删除成员 管理员？</div>
        <div class="btns center">
            <button type="button" class="btn btn_h" onClick="closePopBox()">取消</button>
            <button type="button" class="btn" onClick="closePopBox()">确定</button>
        </div>
    </div>

    
    

    
</div>

<script src="../js/jquery.min.js" type="text/javascript"></script>
<script src="../js/select.js" type="text/javascript"></script>
<script src="../js/popup.js" type="text/javascript"></script>
<script src="../js/jquery.webui-popover.min.js" type="text/javascript"></script>
<script src="../js/bootstrap-data/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="../js/bootstrap-data/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<script type="text/javascript" src="../layui/layui.js"></script>
<script type="text/javascript" src="../config/config.js"></script>
<script>

  
	(function(){
		var settings = {
			trigger:'hover',
			multi:true,						
			closeable:false,
			style:'',
			padding:true
		};
		function initPopover(){					
			$('a.show-pop').webuiPopover('destroy').webuiPopover(settings);	
		}
		initPopover();	
	})();	
	
	$("#datetimeStart").datetimepicker({
        format: 'yyyy-mm-dd',
        minView:'month',
        language: 'zh-CN',
        autoclose:true,
        startDate:new Date()
    }).on("click",function(){
        $("#datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val())
    });
    $("#datetimeEnd").datetimepicker({
        format: 'yyyy-mm-dd',
        minView:'month',
        language: 'zh-CN',
        autoclose:true,
        startDate:new Date()
    }).on("click",function(){
        $("#datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val())
    });
	
	/*弹窗共用操作*/
	function showPopBox(index){
		var box = $('.pop_inner');
		var popClose = $('.pop_close');
		box.hide().eq(index).show();
		$('#popShow').popupOpen();
		popClose.click(function(){
			$('#popShow').hide();
			$('#popShow').popupClose();
		});
	}
	
	function closePopBox(){
		$('#popShow').hide();
		$('#popShow').popupClose();
  }
  
  /**
   * 新增用户方法
   */
  function addUser(){
    debugger
    var Name =$("#userName").val();
    var pwd=$("#passWord").val();
    var ph=$("#phone").val();
       var user ={};
       //空校验
       if(Name&&pwd&&ph){
        user.userName=Name;
        user.passWord=pwd;
        user.mobile=ph;
       }else{
        layer.msg('字段不能为空',{icon: 5,time:1000}); 
         return false;
       }
       $.ajax({
			type : 'post',
			url : contextValus.contextPath+'/admin/addUser',
			contentType: "application/json",
			data : JSON.stringify(user),
			success : function(result) {
        //成功
				if(result.code==0){
          layer.msg(result.msg,{icon: 5,time:1000}); 
          $('#popShow').hide();
         $('#popShow').popupClose();
         location.href ="/guanli/userList.html"
				}else {
          layer.msg(result.msg,{icon: 5,time:1000}); 
          return false
				}
            
			},
			error : function(xhr, textStatus, errorThrown) {
        layer.msg('新增失败，请联系管理员！',{icon: 5,time:1000});
			}
		});



  }
 /**
   /**
     * 编辑确认事件
     */
   
   function editUser(){
    var Name =$("#userEditName").val();
    var pwd=$("#userEditPwd").val();
    var ph=$("#userEditPhone").val();
   var addid= $("#Id").val();
       var user ={};
       //空校验
       if(Name&&pwd&&ph){
        user.userName=Name;
        user.passWord=pwd;
        user.mobile=ph;
        user.id=addid;

       }else{
        layer.msg('字段不能为空',{icon: 5,time:1000}); 
         return false;
       }
       $.ajax({
			type : 'post',
			url : contextValus.contextPath+'/admin/update',
			contentType: "application/json",
			data : JSON.stringify(user),
			success : function(result) {
        //成功
				if(result.code==0){
          layer.msg(result.msg,{icon: 5,time:1000}); 
          $('#popShow').hide();
         $('#popShow').popupClose();
         location.href ="/guanli/userList.html"
				}else {
          layer.msg(result.msg,{icon: 5,time:1000}); 
          return false
				}
            
			},
			error : function(xhr, textStatus, errorThrown) {
        layer.msg('修改失败，请联系管理员！',{icon: 5,time:1000});
			}
		});



  }
  /**
   * 列表数据渲染
   */
   layui.use(['jquery','table'], function(){
    layer.config({
  skin: 'layui-layer-setmybg'
  
})
		var table = layui.table;
		table.render({
			elem: '#test'
			,method:'POST'
			,contentType: 'application/json'
      ,url:contextValus.contextPath+'/admin/list'
      ,
      cellMinWidth: 80,
			title: '用户数据表'
    
      ,cols: [[
      {field:'id', title: 'ID'}
      ,{field:'userName', title: '用户名'}
      ,{field:'passWord', title: '密码'}
      ,{field:'mobile', title: '手机号码'}
      ,{field:'right', title: '操作', toolbar: '#barDemo'}
    
    ]],id: 'testReload'
			,page: true
    });
  /**
   * 条件查询
   */
   var $ = layui.$, active = {
			reload: function(){
				var demoReload = $('#demoReload');
				//执行重载
				table.reload('testReload', {
					page: {
						curr: 1 //重新从第 1 页开始
					}
					,where: {
            //传入条件
						userName:demoReload.val()
					
					}
				}, 'data');
			}
		};

		$('.fr .btn').on('click', function(){
			var type = $(this).data('type');
			active[type] ? active[type].call(this) : '';
		});

	//监听行工具事件
  table.on('tool(test)', function(obj){
      var data = obj.data;
     var user={}
     user.id=data.id;
			var arr = [];
			arr.push(data);
			if(obj.event === 'del'){
				layer.confirm('真的删除行么', function(index){
					$.ajax({
						type : 'post',
						url : contextValus.contextPath+'admin/delete',
						async : false,
						contentType: 'application/json',
						data : JSON.stringify(user),
						success : function(result) {
							layer.msg(result.msg);
						}
					});
					obj.del();
					layer.close(index);
				});
			} else if(obj.event === 'edit'){
        showPopBox(1);
      //	window.location = '${pageContext.request.contextPath }/url/skipUpdateIsCheckClassify?id=' + data.id;
          $("#userEditName").val(data.userName);
          $("#userEditPwd").val(data.passWord);
          $("#userEditPhone").val(data.mobile);
            $("#Id").val(data.id);

			}
    });
    
 

  });


</script>

</body>
</html>